<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AC Car Model - three.js Integration</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1a1a1a;
      color: #fff;
    }

    #container {
      width: 100vw;
      height: 100vh;
      position: relative;
    }

    #canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    #info {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 8px;
      font-size: 14px;
    }

    h1 {
      margin: 0 0 10px 0;
      font-size: 20px;
    }

    p {
      margin: 5px 0;
      color: #aaa;
    }

    #controls {
      position: absolute;
      bottom: 20px;
      left: 20px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 8px;
    }

    button {
      margin: 5px;
      padding: 10px 20px;
      background: #007bff;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: #0056b3;
    }

    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div id="container">
    <canvas id="canvas"></canvas>

    <div id="info">
      <h1>AC Car Model Viewer</h1>
      <p>Model: <span id="model-name">Loading...</span></p>
      <p>Meshes: <span id="mesh-count">-</span></p>
      <p>Materials: <span id="material-count">-</span></p>
      <p>File size: <span id="file-size">-</span></p>
      <p style="margin-top: 10px; font-size: 12px; color: #666;">
        Mouse: Rotate | Scroll: Zoom
      </p>
    </div>

    <div id="controls">
      <button onclick="loadCar('ks_ferrari_488_gt3')">Ferrari 488 GT3</button>
      <button onclick="loadCar('ks_porsche_911_gt3_r_2016')">Porsche 911 GT3</button>
      <button onclick="loadCar('ks_lamborghini_huracan_gt3')">Lamborghini Hurac√°n GT3</button>
    </div>

    <div id="loading">Loading three.js...</div>
  </div>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

    // Scene setup
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x1a1a1a);

    const camera = new THREE.PerspectiveCamera(
      50,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    camera.position.set(5, 2, 5);

    const renderer = new THREE.WebGLRenderer({
      canvas: document.getElementById('canvas'),
      antialias: true
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);

    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 10, 5);
    scene.add(directionalLight);

    const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.5);
    directionalLight2.position.set(-5, 5, -5);
    scene.add(directionalLight2);

    // Controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.target.set(0, 0.5, 0);

    // Ground
    const groundGeometry = new THREE.PlaneGeometry(20, 20);
    const groundMaterial = new THREE.MeshStandardMaterial({
      color: 0x333333,
      roughness: 0.8
    });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);

    // Grid
    const gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x222222);
    scene.add(gridHelper);

    // GLTF Loader
    const loader = new GLTFLoader();
    let currentModel = null;

    // Load car model
    window.loadCar = function(carId) {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('model-name').textContent = 'Loading...';

      const modelPath = `../output/gltf/${carId}.glb`;

      // Remove previous model
      if (currentModel) {
        scene.remove(currentModel);
      }

      loader.load(
        modelPath,
        (gltf) => {
          currentModel = gltf.scene;

          // Center model
          const box = new THREE.Box3().setFromObject(currentModel);
          const center = box.getCenter(new THREE.Vector3());
          currentModel.position.sub(center);

          // Scale to reasonable size
          const size = box.getSize(new THREE.Vector3());
          const maxDim = Math.max(size.x, size.y, size.z);
          const scale = 2 / maxDim;
          currentModel.scale.multiplyScalar(scale);

          scene.add(currentModel);

          // Update info
          document.getElementById('loading').style.display = 'none';
          document.getElementById('model-name').textContent = carId;

          let meshCount = 0;
          let materialCount = 0;

          currentModel.traverse((child) => {
            if (child.isMesh) {
              meshCount++;
              if (child.material) {
                materialCount++;
              }
            }
          });

          document.getElementById('mesh-count').textContent = meshCount;
          document.getElementById('material-count').textContent = materialCount;

          // Get file size (approximate)
          fetch(modelPath, { method: 'HEAD' })
            .then(response => {
              const sizeKB = Math.round(
                parseInt(response.headers.get('content-length')) / 1024
              );
              document.getElementById('file-size').textContent = `${sizeKB} KB`;
            })
            .catch(() => {
              document.getElementById('file-size').textContent = 'Unknown';
            });

          console.log('Model loaded:', {
            meshes: meshCount,
            materials: materialCount,
            scene: gltf.scene
          });
        },
        (xhr) => {
          const percent = Math.round((xhr.loaded / xhr.total) * 100);
          document.getElementById('loading').textContent = `Loading... ${percent}%`;
        },
        (error) => {
          console.error('Error loading model:', error);
          document.getElementById('loading').textContent = 'Error loading model';
          document.getElementById('model-name').textContent = 'Failed to load';
        }
      );
    };

    // Animation loop
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    // Handle window resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Start
    document.getElementById('loading').style.display = 'none';
    animate();

    // Auto-load first car
    loadCar('ks_ferrari_488_gt3');
  </script>
</body>
</html>
