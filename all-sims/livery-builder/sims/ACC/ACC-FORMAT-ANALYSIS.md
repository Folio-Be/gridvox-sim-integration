# ACC (Assetto Corsa Competizione) Livery Format Analysis

## Overview

Assetto Corsa Competizione uses a **PNG-based livery system** with a structured directory format and JSON configuration files.

## Package Structure

```
livery_package/
‚îú‚îÄ‚îÄ Cars/
‚îÇ   ‚îî‚îÄ‚îÄ [car_name].json          # Car configuration (colors, materials)
‚îî‚îÄ‚îÄ Liveries/
    ‚îî‚îÄ‚îÄ [livery_name]/
        ‚îú‚îÄ‚îÄ decals.json          # Material properties
        ‚îú‚îÄ‚îÄ decals.png           # Main livery texture (4096x4096)
        ‚îú‚îÄ‚îÄ decals_0.dds         # Optional DDS version
        ‚îî‚îÄ‚îÄ sponsors.json        # Sponsor configuration (optional)
```

### Alternative Structure (Custom Liveries)
```
Customs/
‚îú‚îÄ‚îÄ Cars/
‚îÇ   ‚îî‚îÄ‚îÄ [car_name].json
‚îî‚îÄ‚îÄ Liveries/
    ‚îî‚îÄ‚îÄ [livery_name]/
        ‚îú‚îÄ‚îÄ decals.json
        ‚îú‚îÄ‚îÄ decals.png
        ‚îî‚îÄ‚îÄ sponsors.png
```

## Extracted Templates

### 1. BMW M4 GT3 EVO
**Location**: `BMW_M4_GT3_EVO/`

**Files:**
- `Cars/BMW M4 GT3 EVO.json` - Car configuration
- `Liveries/BMW M4 GT3 EVO/decals.png` - **5.64 MB, 4096x4096, RGBA**
- `Liveries/BMW M4 GT3 EVO/decals_0.dds` - **21.33 MB, DXT5 (optional)**
- `Liveries/BMW M4 GT3 EVO/decals.json` - Material properties
- `Liveries/BMW M4 GT3 EVO/sponsors.json` - Sponsor config

### 2. Porsche 992 GT3R (Coca Cola JD)
**Location**: `992 coke jd/`

**Files:**
- `Cars/992 COCA COLA JD.json`
- `Liveries/992 COCA COLA JD/DECALS.png` - **0.56 MB, 4096x4096** (compressed)
- `Liveries/992 COCA COLA JD/SPONSORS.png` - **0.75 MB**
- `Liveries/992 COCA COLA JD/decals.json`
- `Liveries/992 COCA COLA JD/sponsors.json`

### 3. Porsche 911 GT3R (Pink Pig)
**Location**: `Phantom Global Pink Pig GT3R/`

**Files:**
- `Customs/Cars/Phantom_Global_Pink_Pig_GT3R.json`
- `Customs/Liveries/Phantom_Global_Pink_Pig_GT3R/decals.png` - **0.16 MB**
- `Customs/Liveries/Phantom_Global_Pink_Pig_GT3R/sponsors.png` - **0.71 MB**
- `Customs/Liveries/Phantom_Global_Pink_Pig_GT3R/decals.json`
- `Customs/Liveries/Phantom_Global_Pink_Pig_GT3R/sponsors.json`

## File Format Details

### decals.png
**Purpose**: Main livery texture (car body)  
**Format**: PNG with alpha channel  
**Resolution**: 4096x4096 (4K standard)  
**Color**: 32-bit RGBA (Format32bppArgb)  
**Size**: 0.16 MB (highly compressed) to 5.64 MB (less compressed)  
**Usage**: Primary livery design applied to car body UV map

### sponsors.png (Optional)
**Purpose**: Sponsor/decal overlay texture  
**Format**: PNG with alpha channel  
**Resolution**: Variable (often 2K or 4K)  
**Usage**: Additional sponsor logos, team branding

### decals_0.dds (Optional)
**Purpose**: DDS version of main livery for game use  
**Format**: DXT5 compressed DDS  
**Resolution**: 4096x4096  
**Size**: 21.33 MB (uncompressed DXT5)  
**Usage**: Game engine optimized format (auto-generated by ACC)

## Configuration Files

### decals.json
Material properties for PBR (Physically Based Rendering):

```json
{
  "baseRoughness": 2,         // Surface roughness (0-10)
  "clearCoat": 0,             // Clear coat layer (0-1)
  "clearCoatRoughness": 0,    // Clear coat roughness
  "metallic": 0               // Metallic property (0-1)
}
```

**Values:**
- `baseRoughness`: 0 = glossy/shiny, 10 = matte/rough
- `clearCoat`: 0 = no clear coat, 1 = full clear coat (like gloss finish)
- `metallic`: 0 = non-metallic, 1 = fully metallic

### sponsors.json
Empty or contains sponsor configuration (structure TBD).

### [car_name].json
Complete car configuration including:

```json
{
  "carGuid": 0,
  "teamGuid": 0,
  "raceNumber": 1,
  "skinTemplateKey": 98,         // Livery template selection
  "skinColor1Id": 341,           // Primary color
  "skinColor2Id": 1,             // Secondary color
  "skinColor3Id": 243,           // Tertiary color
  "skinMaterialType1": 1,        // Material type for color 1
  "skinMaterialType2": 1,        // Material type for color 2
  "skinMaterialType3": 0,        // Material type for color 3
  "rimColor1Id": 1,              // Wheel rim primary color
  "rimColor2Id": 340,            // Wheel rim secondary color
  "rimMaterialType1": 2,         // Rim material type
  "teamName": "BMW M4 GT3 EVO",
  "customSkinName": "BMW M4 GT3 EVO",
  "carModelType": 30,            // Car model ID
  "useEnduranceKit": 1           // Endurance aero package
}
```

## Format Comparison

| Aspect | ACC (PNG) | AMS2 (PSD) | LMU (TGA) | MSFS (DDS) |
|--------|-----------|------------|-----------|------------|
| **Primary Format** | PNG RGBA | PSD Layered | TGA RGB | DDS DXT5 |
| **Resolution** | 4096x4096 | 4096-8192 | 4096x4096 | 4096-8192 |
| **File Size** | 0.16-5.64 MB | 23-78 MB | 2-48 MB | 10-21 MB |
| **Layers** | None (flattened) | Multiple layers | None | Component-based |
| **Game Format** | PNG ‚Üí DDS | PSD ‚Üí DDS | TGA ‚Üí DDS | DDS native |
| **Editability** | Direct pixel editing | Layer-based design | Direct pixel editing | Component editing |
| **Material Info** | JSON file | In PSD metadata | None | Multiple maps (ALBD/NORM/COMP) |

## ACC Workflow

### Current (Manual)
1. Edit `decals.png` in Photoshop/GIMP
2. Optionally edit `sponsors.png`
3. Adjust material properties in `decals.json`
4. Place in ACC Liveries folder
5. Game auto-generates DDS on load

### Proposed (SimVox Pipeline)
1. **Load Package**: Detect ACC structure (Cars + Liveries folders)
2. **Load PNG**: Parse `decals.png` as ImageData
3. **Edit**: Use drawing tools on canvas
4. **Preview**: Show with material properties (roughness, metallic)
5. **Export**: Save as PNG (ACC native) or DDS (game-ready)
6. **Repackage**: Preserve JSON files and directory structure

## Integration with Unified Pipeline

### Format Detection
```typescript
// Detect ACC package
if (hasDir(dir, 'Cars') && 
    hasDir(dir, 'Liveries') &&
    hasFile(dir, 'Liveries/*/decals.png')) {
  return { sim: 'ACC', type: 'png-package' };
}

// Detect ACC custom package
if (hasDir(dir, 'Customs/Cars') && 
    hasDir(dir, 'Customs/Liveries')) {
  return { sim: 'ACC', type: 'png-package', variant: 'custom' };
}
```

### Main Texture Identification
Priority order for loading:
1. `decals.png` (primary livery, always present)
2. `sponsors.png` (overlay, optional)
3. `decals_0.dds` (game-generated, optional)

### Material Properties
- Load `decals.json` for PBR preview
- Show material sliders in UI
- Update JSON on export

## Advantages of PNG Format

### ‚úÖ Pros
1. **Browser Native**: No special parser needed
2. **Lossless**: No compression artifacts (if PNG compression is low)
3. **Alpha Channel**: Built-in transparency support
4. **Universal**: Any image editor can open/save PNG
5. **Lightweight**: 0.16-5.64 MB (much smaller than DDS)

### ‚ö†Ô∏è Cons
1. **No Layers**: Cannot separate wireframe/AO like PSD
2. **No Mipmaps**: Game generates them (not in source file)
3. **Compression Variance**: File size varies widely based on PNG compression

## Browser Integration

### Loading PNG
```typescript
// Native browser support - no library needed!
const img = new Image();
img.src = URL.createObjectURL(pngBlob);

img.onload = () => {
  const canvas = document.createElement('canvas');
  canvas.width = img.width;
  canvas.height = img.height;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(img, 0, 0);
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  // Ready to edit!
};
```

### Exporting PNG
```typescript
// Canvas API built-in export
canvas.toBlob((blob) => {
  // Save blob as PNG file
}, 'image/png', 1.0); // Quality: 0.0-1.0
```

**No library required** - PNG is natively supported in browsers! üéâ

## Implementation Priority

### Phase 1: PNG Loader (EASY - 1 day)
- [x] Templates downloaded and extracted
- [ ] Create `PNGLoader.tsx` component
- [ ] Use native `Image()` constructor
- [ ] Draw to canvas ‚Üí get ImageData
- [ ] Test with BMW M4 GT3 EVO `decals.png`

**Complexity**: ‚≠ê LOW - Browser native support

### Phase 2: Package Structure (MEDIUM - 1 day)
- [ ] Parse `Cars/*.json` for car config
- [ ] Parse `decals.json` for material properties
- [ ] Load optional `sponsors.png` as overlay layer
- [ ] Display material properties in UI

**Complexity**: ‚≠ê‚≠ê MEDIUM - JSON parsing + multi-file

### Phase 3: Material Preview (ADVANCED - 2-3 days)
- [ ] Apply roughness effect (shader or canvas filter)
- [ ] Apply metallic effect
- [ ] Real-time preview as user edits

**Complexity**: ‚≠ê‚≠ê‚≠ê HIGH - Requires WebGL or advanced canvas techniques

## Challenges

### Material Properties Preview
- **Problem**: Roughness/metallic are 3D rendering properties
- **Solution**: Approximate with canvas filters or WebGL shaders
- **Alternative**: Show properties as info, no visual preview

### DDS Generation
- **Problem**: ACC expects DDS files for optimal performance
- **Solution**: Export PNG (ACC auto-generates DDS) OR implement DDS encoder
- **Recommended**: Export PNG only, let game handle DDS

### Package Integrity
- **Problem**: JSON files must be preserved
- **Solution**: Read all JSONs on load, preserve on export

## Next Steps

1. **Create PNGLoader Component** (Easy win!)
   ```typescript
   export function PNGLoader({ onLoad }: { onLoad: (imageData: ImageData) => void }) {
     const handleLoad = async () => {
       const path = await openFileDialog({ filters: [{ name: 'PNG', extensions: ['png'] }] });
       const blob = await readFile(path);
       const img = new Image();
       img.src = URL.createObjectURL(blob);
       img.onload = () => {
         const canvas = createCanvas(img.width, img.height);
         const ctx = canvas.getContext('2d')!;
         ctx.drawImage(img, 0, 0);
         const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
         onLoad(imageData);
       };
     };
     // ... UI
   }
   ```

2. **Add to POC** (5 minutes)
   - Add "Load PNG Livery" button
   - Use existing `UnifiedCanvas` component
   - Test with `ACC/BMW_M4_GT3_EVO/Liveries/BMW M4 GT3 EVO/decals.png`

3. **Package Detection** (Later)
   - Detect ACC folder structure
   - Load all related files (decals.png, sponsors.png, JSONs)
   - Build ACC-specific UI

## Conclusion

ACC format is the **easiest to implement**:
- ‚úÖ **Native Browser Support**: No external libraries needed
- ‚úÖ **Simple Structure**: PNG + JSON files
- ‚úÖ **Lightweight**: 0.16-5.64 MB files
- ‚úÖ **Universal Format**: Any editor works

**Recommended**: Implement PNG loader **immediately** as proof-of-concept before tackling complex DDS/MSFS formats.

**Priority**: üöÄ **HIGH** - Quick win, native support, simple implementation.

---

## Template Summary

**Downloaded**: 3 ACC livery packages  
**Total Size**: ~28 MB  
**Format**: PNG (4096x4096) + JSON configs  
**Status**: ‚úÖ Ready for implementation  
**Complexity**: ‚≠ê LOW (easiest format)  

**Next Action**: Create `PNGLoader.tsx` component (estimated time: 1 hour).
