import {initializeConcurrentStreams} from 'execa/lib/convert/concurrent.js';
import {createReadable} from 'execa/lib/convert/readable.js';
import {createWritable} from 'execa/lib/convert/writable.js';
import {createDuplex} from 'execa/lib/convert/duplex.js';
import {createIterable} from 'execa/lib/convert/iterable.js';

// Add methods to convert the subprocess to a stream or iterable
export const addConvertedStreams = (subprocess, {encoding}) => {
	const concurrentStreams = initializeConcurrentStreams();
	subprocess.readable = createReadable.bind(undefined, {subprocess, concurrentStreams, encoding});
	subprocess.writable = createWritable.bind(undefined, {subprocess, concurrentStreams});
	subprocess.duplex = createDuplex.bind(undefined, {subprocess, concurrentStreams, encoding});
	subprocess.iterable = createIterable.bind(undefined, subprocess, encoding);
	subprocess[Symbol.asyncIterator] = createIterable.bind(undefined, subprocess, encoding, {});
};
